////////////////////////////////////////////////////||
// ROB KANDEL  										||
// kandelrob@gmail.com								||
// 													||
// created 07.09.15	| updated 07.21.15				||
// app.min.js										||
// version 0.0.5									||
////////////////////////////////////////////////////||

var _septa=function(){var e,a,t,r,l,o,n,s=[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"7",label:"7"},{value:"8",label:"8"},{value:"9",label:"9"},{value:"12",label:"12"},{value:"14",label:"14"},{value:"17",label:"17"},{value:"18",label:"18"},{value:"19",label:"19"},{value:"20",label:"20"},{value:"21",label:"21"},{value:"22",label:"22"},{value:"23",label:"23"},{value:"24",label:"24"},{value:"25",label:"25"},{value:"26",label:"26"},{value:"27",label:"27"},{value:"28",label:"28"},{value:"29",label:"29"},{value:"30",label:"30"},{value:"31",label:"31"},{value:"32",label:"32"},{value:"33",label:"33"},{value:"35",label:"35"},{value:"37",label:"37"},{value:"38",label:"38"},{value:"39",label:"39"},{value:"40",label:"40"},{value:"42",label:"42"},{value:"43",label:"43"},{value:"44",label:"44"},{value:"46",label:"46"},{value:"47",label:"47"},{value:"48",label:"48"},{value:"50",label:"50"},{value:"52",label:"52"},{value:"53",label:"53"},{value:"54",label:"54"},{value:"55",label:"55"},{value:"56",label:"56"},{value:"57",label:"57"},{value:"58",label:"58"},{value:"59",label:"59"},{value:"60",label:"60"},{value:"61",label:"61"},{value:"62",label:"62"},{value:"64",label:"64"},{value:"65",label:"65"},{value:"66",label:"66"},{value:"67",label:"67"},{value:"68",label:"68"},{value:"70",label:"70"},{value:"73",label:"73"},{value:"75",label:"75"},{value:"77",label:"77"},{value:"78",label:"78"},{value:"79",label:"79"},{value:"80",label:"80"},{value:"84",label:"84"},{value:"88",label:"88"},{value:"89",label:"89"},{value:"C",label:"C"},{value:"G",label:"G"},{value:"HXH",label:"HXH"},{value:"J",label:"J"},{value:"K",label:"K"},{value:"L",label:"L"},{value:"R",label:"R"},{value:"LUCY",label:"LUCY"},{value:"90",label:"90"},{value:"91",label:"91"},{value:"92",label:"92"},{value:"93",label:"93"},{value:"94",label:"94"},{value:"95",label:"95"},{value:"96",label:"96"},{value:"97",label:"97"},{value:"98",label:"98"},{value:"99",label:"99"},{value:"103",label:"103"},{value:"104",label:"104"},{value:"105",label:"105"},{value:"106",label:"106"},{value:"107",label:"107"},{value:"108",label:"108"},{value:"109",label:"109"},{value:"110",label:"110"},{value:"111",label:"111"},{value:"112",label:"112"},{value:"113",label:"113"},{value:"114",label:"114"},{value:"115",label:"115"},{value:"116",label:"116"},{value:"117",label:"117"},{value:"118",label:"118"},{value:"119",label:"119"},{value:"120",label:"120"},{value:"123",label:"123"},{value:"124",label:"124"},{value:"125",label:"125"},{value:"126",label:"126"},{value:"127",label:"127"},{value:"128",label:"128"},{value:"129",label:"129"},{value:"130",label:"130"},{value:"131",label:"131"},{value:"132",label:"132"},{value:"133",label:"133"},{value:"134",label:"134"},{value:"139",label:"139"},{value:"150",label:"150"},{value:"201",label:"201"},{value:"204",label:"204"},{value:"205",label:"205"},{value:"206",label:"206"},{value:"310",label:"310"},{value:"airport",label:"Airport"},{value:"chestnut-h-east",label:"Chestnut Hill East"},{value:"chestnut-h-west",label:"chestnut Hill West"},{value:"doylestown",label:"Doylestown"},{value:"elwyn",label:"Elwyn"},{value:"fox-chase",label:"Fox Chase"},{value:"malvern",label:"Malvern"},{value:"marcus-hook",label:"Marcus Hook"},{value:"norristown",label:"Norristown"},{value:"paoli",label:"Paoli"},{value:"temple-u",label:"Temple U"},{value:"thorndale",label:"Thorndale"},{value:"trenton",label:"Trenton"},{value:"warminster",label:"Warminster"},{value:"west-trenton",label:"West Trenton"},{value:"wilmington",label:"Wilmington"},{value:"10",label:"10"},{value:"11",label:"11"},{value:"13",label:"13"},{value:"15",label:"15"},{value:"34",label:"34"},{value:"36",label:"36"},{value:"101",label:"101"},{value:"102",label:"102"}],u=["1","2","3","4","5","6","7","8","9","12","14","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","35","37","38","39","40","42","43","44","46","47","48","50","52","53","54","55","56","57","58","59","60","61","62","64","65","66","67","68","70","73","75","77","78","79","80","84","88","89","C","G","HXH","J","K","L","R","LUCY","90","91","92","93","94","95","96","97","98","99","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","123","124","125","126","127","128","129","130","131","132","133","134","139","150","201","204","205","206","310"],d=["airport","chestnut-h-east","chestnut-h-west","doylestown","elwyn","fox-chase","malvern","marcus-hook","norristown","paoli","temple-u","thorndale","trenton","warminster","west-trenton","wilmington"],c=["10","11","13","15","34","36","101","102"],p=["30th Street Station","49th Street","Airport Terminal A","Airport Terminal B","Airport Terminal C D","Airport Terminal E F","Allegheny","Allen Lane","Ambler","Angora","Ardmore","Ardsley","Bala","Berwyn","Bethayres","Bridesburg","Bristol","Bryn Mawr","Carpenter","Chalfont","Chelten Avenue","Cheltenham","Chester","Chestnut Hill East","Chestnut Hill West","Churchman's Crossing","Claymont","Clifton Aldan","Colmar","Conshohocken","Cornwells Heights","Crestmont","Croydon","Crum Lynne","Curtis Park","Cynwyd","Darby","Daylesford","Delaware Valley College","Devon","Downingtown","Doylestown","East Falls","Eastwick","Eddington","Eddystone","Elkins Park","Elwyn","Exton","Fern Rock T C","Fernwood Yeadon","Folcroft","Forest Hills","Fort Washington","Fortuna","Fox Chase","Germantown","Gladstone","Glenolden","Glenside","Gravers","Gwynedd Valley","Hatboro","Haverford","Highland","Highland Avenue","Holmesburg Jct","Ivy Ridge","Jefferson Station","Jenkintown Wyncote","Langhorne","Lansdale","Lansdowne","Lawndale","Levittown Tullytown","Link Belt","Main Street","Malvern","Manayunk","Marcus Hook","Meadowbrook","Media","Melrose Park","Merion","Miquon","Morton Rutledge","Mount Airy","Moylan Rose Valley","Narberth","Neshaminy","New Britain","Newark","Noble","Norristown Elm Street","Norristown T.C.","North Broad","North Hills","North Philadelphia","North Philadelphia Amtrak","North Wales","Norwood","Olney","Oreland","Overbrook","Paoli","Penllyn","Pennbrook","Philmont","Primos","Prospect Park Moore","Queen Lane","Radnor","Ridley Park","Rosemont","Roslyn","Rydal","Ryers","Secane","Sedgwick","Sharon Hill","Somerton","Spring Mill","St. Davids","St. Martins","Stenton","Strafford","Suburban Station","Swarthmore","Tacony","Temple University","Thorndale","Torresdale","Trenton","Trevose","Tulpehocken","University City","Upsal","Villanova","Wallingford","Warminster","Washington Lane","Wayne","Wayne Junction","West Trenton","Whitford","Willow Grove","Wilmington","Wissahickon","Wister","Woodbourne","Wyndmoor","Wynnefield Avenue","Wynnewood","Yardley"],h=[],y=[],v="",m=!1,b=null,_=!1;return method={init:function(){jQuery("#menu_wrapper").on("click",function(){null!=b&&(clearTimeout(n),jQuery("#timer").data("pietimer")&&jQuery("#timer").pietimer("reset")),jQuery(this).hasClass("menuWrapperActive")?null!=b&&(jQuery(this).removeClass("menuWrapperActive"),jQuery(".preloaderWrapper").hide(),jQuery(".searchWrapper").hide()):(jQuery(this).addClass("menuWrapperActive"),jQuery(".preloaderWrapper").hide(),jQuery(".searchWrapper").show())}),""==method.url_anchor("route")?(jQuery(".preloaderWrapper").hide(),jQuery(".searchWrapper").show()):(jQuery("#route_name").val(method.url_anchor("route")),_=!0,jQuery("#route_search").find("button").prop("disabled",!1),method.get_data.find_route_type(jQuery("#route_name").val(),!1)),method.pick_location(),method.map.start_map()},url_parameter:function(e){for(var a=decodeURI(window.location.search.substring(1)),t=a.split("&"),r=0;r<t.length;r++)if(e==t[r].split("=")[0])return t[r].split("=")[1];return""},url_anchor:function(e){var a=window.location.href,t=a.indexOf("#");return-1!=t?a.substring(t+1).split(e+"=")[1]:""},update_anchor_tag:function(e){{var a=window.location.href;a.indexOf("#")}window.location.hash=null!=e?"#route="+e:""},pick_location:function(){jQuery("#search_type_route").on("click",function(){jQuery("#search_holder_route").slideDown(150),jQuery("#search_holder_find").slideUp(150),jQuery(this).addClass("btn-success").removeClass("btn-default"),jQuery("#search_type_find").removeClass("btn-success").addClass("btn-default")}),jQuery("#search_type_find").on("click",function(){jQuery("#search_holder_route").slideUp(150),jQuery("#search_holder_find").slideDown(150),jQuery(this).addClass("btn-success").removeClass("btn-default"),jQuery("#search_type_route").removeClass("btn-success").addClass("btn-default")}),jQuery("#route_name").autocomplete({source:s,minLength:0,focus:function(e,a){return jQuery("#route_name").val(a.item.label),!1},select:function(e,a){return jQuery("#route_name").val(a.item.value),jQuery("#route_search").find("button").prop("disabled",!1),jQuery("#route_search").click(),!1}}).on("input",function(){jQuery("#route_name").val().length>=1?jQuery("#route_search").find("button").prop("disabled",!1):jQuery("#route_search").find("button").prop("disabled",!0)}).on("keydown",function(e){13==e.keyCode&&jQuery("#route_name").val().length>=1&&jQuery("#route_name").val()!=b&&jQuery("#route_search").click()}).focus(function(){jQuery(this).trigger("keydown.autocomplete")}),jQuery("#route_search").on("click",function(){_=!0,method.get_data.find_route_type(jQuery("#route_name").val(),!0)}),jQuery(".showRouteButton").on("click",function(){jQuery(".showRouteTypes").slideDown(150),jQuery(".inputWrapper").slideUp(150),jQuery(".showRouteButton").slideUp(150)}),method.start_carousel($("#bus_routes"),"bus"),jQuery(".routeTypeButton").each(function(){jQuery(this).on("click",function(){var e=jQuery(".routeTypeButtonWrapper").find(".btn-primary");e.removeClass("btn-primary").addClass("btn-default"),jQuery(this).removeClass(".btn-default").addClass("btn-primary"),jQuery(".routeNumber").slideUp(150),jQuery("#"+jQuery(this).attr("id").split("route_type_")[1]+"_routes").slideDown(150);var a=jQuery("#"+e.attr("id").split("route_type_")[1]+"_routes").data("owlCarousel");a.destroy(),method.start_carousel(jQuery("#"+jQuery(this).attr("id").split("route_type_")[1]+"_routes"),jQuery(this).attr("id").split("route_type_")[1])})}),jQuery(".myLocationButton").on("click",function(){jQuery(".preloaderWrapper").show(),jQuery(".searchWrapper").hide(),jQuery("#menu_wrapper").removeClass("menuWrapperActive"),navigator.geolocation?navigator.geolocation.getCurrentPosition(_septa.return_coords):(alert("Geolocation is not supported by this browser"),jQuery(".preloaderWrapper").hide(),jQuery(".searchWrapper").show())}),jQuery("#geocode_input").on("input",function(){jQuery("#geocode_input").val().length>=1?jQuery("#geocode_search").find("button").prop("disabled",!1):jQuery("#geocode_search").find("button").prop("disabled",!0)}).on("keydown",function(e){13==e.keyCode&&jQuery("#geocode_input").val().length>=1&&jQuery("#geocode_search").click()}),jQuery("#geocode_search").on("click",function(){jQuery("#geocode_input").val().length>=1&&method.geocode.google(jQuery("#geocode_input").val())})},return_coords:function(e){"latitude"in e.coords&&"longitude"in e.coords?method.get_data.find_stations(e.coords.latitude,e.coords.longitude):(alert("Something went wrong, try typing your address"),jQuery(".preloaderWrapper").hide(),jQuery(".searchWrapper").show())},start_carousel:function(e,a){var t=e;t.owlCarousel({items:"train"==a?2:8,responsive:!1}),e.find(".item").each(function(){jQuery(this).unbind("click"),jQuery(this).on("click",function(){jQuery(".showRouteTypes").slideUp(150),jQuery(".inputWrapper").slideDown(150),jQuery(".showRouteButton").slideDown(150),jQuery("#route_name").val(jQuery(this).attr("data-value")),jQuery("#route_search").click()})})},map:{start_map:function(){e=L.map("the_map",{center:[39.952474,-75.16359],zoom:12,minZoom:7,detectRetina:!0});L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}).addTo(e)},add_points:function(a,l){t=new L.LayerGroup,r=new L.LayerGroup,t.clearLayers(),r.clearLayers(),y=[];var o=L.Icon.extend({options:{iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-33],shadowUrl:"icons/marker-shadow.png",shadowRetinaUrl:"icons/marker-shadow@2x.png",shadowSize:[41,41]}}),n=new o({iconUrl:"icons/bus_blue.png",iconRetinaUrl:"icons/bus_blue@2x.png"}),s=new o({iconUrl:"icons/bus_orange.png",iconRetinaUrl:"icons/bus_orange@2x.png"}),u=new o({iconUrl:"icons/train_blue.png",iconRetinaUrl:"icons/train_blue@2x.png"}),d=new o({iconUrl:"icons/train_orange.png",iconRetinaUrl:"icons/train_orange@2x.png"}),c=(new o({iconUrl:"icons/trolley_blue.png",iconRetinaUrl:"icons/trolley_blue@2x.png"}),new o({iconUrl:"icons/trolley_green.png",iconRetinaUrl:"icons/trolley_green@2x.png"}),new L.LatLngBounds),p="bus"==l||"trolley"==l?"bus":"train";for(i in a[p]){var h=L.marker([a[p][i].lat,"bus"==l||"trolley"==l?a[p][i].lng:a[p][i].lon],{id:i,icon:"train"==l?u:"northbound"==a[p][i].Direction.toLowerCase()||"westbound"==a[p][i].Direction.toLowerCase()?"bus"==l?n:u:"bus"==l?s:d}),v=new L.LatLng(parseFloat(a[p][i].lat),parseFloat("bus"==l||"trolley"==l?a[p][i].lng:a[p][i].lon));"bus"==l||"trolley"==l?("northbound"==a[p][i].Direction.toLowerCase()||"westbound"==a[p][i].Direction.toLowerCase()?t.addLayer(h):r.addLayer(h),c.extend(v),h.bindPopup('<table class="table"><thead><tr><th style="border-bottom: 2px solid #ccc;"><h4 style="margin: 0;">Route: #'+b+'</h4></th><th style="border-bottom: 2px solid #ccc;">&nbsp;</th></tr></thead><tbody><tr><td style="padding-top: 5px;"><b>Direction:</b></td><td style="padding-top: 5px;">'+a[p][i].Direction.replace("Bound","bound")+"</td></tr><tr><td><b>Bus #:</b></td><td>"+a[p][i].VehicleID+"</td></tr>"+(""!=a[p][i].destination?"<tr><td><b>Destination:</b></td><td>"+a[p][i].destination+"</td></tr>":"")+'<tr><td><b>Updated:</b></td><td><i style="color:#d9534f; font-weight: 300;">'+method.parse_data.calc_time(a[p][i].Offset_sec)+"</i></td></tr></tbody></table>"),y.push(h)):a[p][i].dest.toLowerCase().replace(/\s/g,"-")==b&&(t.addLayer(h),c.extend(v),h.bindPopup("<h4>Route: "+$('div[data-value="'+b+'"]').html()+'</h4><table class="table"><tbody><tr><td><b>Train #:</b></td><td>'+a[p][i].trainno+"</td></tr>"+(""!=a[p][i].nextstop?"<tr><td><b>Next Stop:</b>&nbsp;&nbsp;&nbsp;</td><td>"+a[p][i].nextstop+"</td></tr>":"")+(""!=a[p][i].service?"<tr><td><b>Service:</b></td><td>"+a[p][i].service+"</td></tr>":"")+'<tr><td><b>Late:</b></td><td><i style="'+(0==parseFloat(a[p][i].late)?"color:#5cb85c":"color:#d9534f")+'; font-weight: 300;">'+(0==parseFloat(a[p][i].late)?"On time":a[p][i].late+" min")+"</i></td></tr></tbody></table>"),y.push(h))}t.addTo(e),"bus"==l||"trolley"==l?(r.addTo(e),e.options.maxZoom=19):"train"==l&&(e.options.maxZoom=13),setTimeout(function(){y.length>0?_&&(e.panTo(e.fitBounds(c).getCenter()),_=!1):(alert("Sorry, no results found"),jQuery(".preloaderWrapper").hide(),jQuery(".searchWrapper").show()),jQuery(".ui-autocomplete").hide()},100),jQuery(".preloaderWrapper").hide()},add_bus_lines:function(o,n){l=L.geoJson(o,{style:function(e,a){return"Point"!=e.geometry.type?"bus"==n?{weight:3,color:"#999",opacity:.8,fillColor:"#999",fillOpacity:.5}:{weight:3,color:"#5cb85c",opacity:.8,fillColor:"#5cb85c",fillOpacity:.5}:void 0},pointToLayer:function(e,a){return L.circleMarker(a,{radius:0})}}).addTo(e),h=[],"object"==typeof v&&e.removeControl(v),v=L.control({position:"topright"}),v.onAdd=function(e){var a=L.DomUtil.create("div","info legend");return a.innerHTML+='<table class="table"><tr class="nw_layer buttonItem" data-value="on"><td><img src="icons/bus_blue@2x.png" /></td><td class="nb"><span>North/West Bound</span</td></tr><tr class="se_layer buttonItem" data-value="on"><td><img src="icons/bus_orange@2x.png" /></td><td class="sb"><span>South/East Bound</span></td></tr><tr><td><input type="checkbox" id="show_stops"></td><td>Show all bus stops</td></tr></table>',a},v.addTo(e),jQuery("#show_stops").on("click",function(){jQuery(this).prop("checked")?0==h.length?method.get_data.get_bus_stops(b):method.map.add_all_stops():method.map.remove_layer(a)}),jQuery(".nw_layer").on("click",function(){"on"==jQuery(this).attr("data-value")?(method.map.remove_layer(t),jQuery(this).attr("data-value","off")):(t.addTo(e),jQuery(this).attr("data-value","on"))}),jQuery(".se_layer").on("click",function(){"on"==jQuery(this).attr("data-value")?(method.map.remove_layer(r),jQuery(this).attr("data-value","off")):(r.addTo(e),jQuery(this).attr("data-value","on"))})},add_train_lines:function(a){o=L.geoJson(a,{style:function(e,a){return"Point"!=e.geometry.type?e.properties.name==b?{weight:3,color:"#f0ad4e",opacity:.8,fillColor:"#f0ad4e",fillOpacity:.5}:{weight:3,color:"#999",opacity:.5,fillColor:"#999",fillOpacity:0}:void 0},pointToLayer:function(e,a){return L.circleMarker(a,{radius:0})}}).addTo(e),"object"==typeof v&&e.removeControl(v),v=L.control({position:"topleft"}),v.onAdd=function(e){var a=L.DomUtil.create("div","info legend arrivalLegend");return a.innerHTML+='<div class="arrivalLegendWrapper"><div class="arrivalLegendBTN buttonItem transitionAll"><span><i class="fa fa-calendar"></i></span></div><div class="arrivalInfoWrapper transitionAll"><div class="arrivalTitle transitionAll">Arrival Schedule</div><form class="form-inline"><div class="form-group"><input type="text" class="form-control" id="next_arrival_start" placeholder="Origin"></div><div class="form-group"><input type="text" class="form-control" id="next_arrival_end" placeholder="Destination"></div><button id="arrival_search" class="btn btn-primary transitionAll" type="button">Search</button></form><div class="arrivalTableWrapper"><div class="spinnerWrapper"></div><table class="table arrivalTable"></table></div></div></div>',L.DomEvent.disableClickPropagation(a),a},v.addTo(e),jQuery(".arrivalLegendBTN").unbind("click"),jQuery(".arrivalLegendBTN").on("click",function(){method.map.train_schedule()}),jQuery("#arrival_search").unbind("click").prop("disabled",!0),jQuery("#arrival_search").on("click",function(){""!=jQuery("#next_arrival_start").val()&&""!=jQuery("#next_arrival_end").val()?method.get_data.arrival_times(jQuery("#next_arrival_start").val(),jQuery("#next_arrival_end").val()):alert(""!=jQuery("#next_arrival_start").val()?"Enter Origin":"Enter Destination")}),jQuery("#next_arrival_end").unbind(),jQuery("#next_arrival_end").on("input",function(){jQuery(this).val().length>0&&jQuery("#arrival_search").prop("disabled",!1)}).on("keydown",function(e){13==e.keyCode&&jQuery("#arrival_search").click()}),jQuery("#next_arrival_start, #next_arrival_end").autocomplete({source:p,minLength:0}).autocomplete("widget").addClass("scheduleAutoComplete")},add_all_stops:function(){a=new L.LayerGroup,a.clearLayers();for(i in h){var t=L.circle([h[i].lat,h[i].lng],12,{color:"#c9302c",fillColor:"#d9534f",fillOpacity:.85});a.addLayer(t),t.bindPopup(h[i].stopname)}a.addTo(e)},add_found_stops:function(a){t=new L.LayerGroup;var r=L.Icon.extend({options:{iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-33],shadowUrl:"icons/marker-shadow.png",shadowRetinaUrl:"icons/marker-shadow@2x.png",shadowSize:[41,41]}}),l=new r({iconUrl:"icons/bus_found_stop.png",iconRetinaUrl:"icons/bus_found_stop@2x.png"}),o=new r({iconUrl:"icons/train_found_stop.png",iconRetinaUrl:"icons/train_found_stop@2x.png"}),n=new r({iconUrl:"icons/trolley_found_stop.png",iconRetinaUrl:"icons/trolley_found_stop@2x.png"}),s=new L.LatLngBounds;for(i in a)if(("bus_stops"==a[i].location_type||"rail_stations"==a[i].location_type||"trolley_stops"==a[i].location_type)&&""!=a[i].location_lat&&""!=a[i].location_lon){var u=L.marker([a[i].location_lat,a[i].location_lon],{id:i,icon:"bus_stops"==a[i].location_type?l:"rail_stations"==a[i].location_type?o:n}),d=new L.LatLng(a[i].location_lat,a[i].location_lon);t.addLayer(u),s.extend(d),u.bindPopup("<h4>"+a[i].location_name+'</h4><table class="table"><tbody><tr><td style="padding-top: 5px;"><b>Type:</b></td><td style="padding-top: 5px;">'+a[i].location_type.replace("bus","Bus").replace("trolley","Trolley").replace("_stops"," stop").replace("rail","Train").replace("_stations"," station")+'</td></tr><tr><td><b>Distance:</b></td><td><i style="color:#d9534f; font-weight: 300;">'+a[i].distance+" miles</i></td></tr></tbody></table>"),y.push(u)}e.options.maxZoom=19,t.addTo(e),setTimeout(function(){e.panTo(e.fitBounds(s).getCenter())},100),jQuery(".preloaderWrapper").hide()},train_schedule:function(){jQuery(".arrivalInfoWrapper").hasClass("arrivalInfoWrapperActive")?jQuery(".arrivalInfoWrapper").removeClass("arrivalInfoWrapperActive").slideUp():jQuery(".arrivalInfoWrapper").addClass("arrivalInfoWrapperActive").slideDown()},remove_layer:function(a){e.removeLayer(a)},clear_all:function(){null!=b&&(clearTimeout(n),"object"==typeof t&&method.map.remove_layer(t),"object"==typeof r&&method.map.remove_layer(r),"object"==typeof l&&method.map.remove_layer(l),"object"==typeof o&&method.map.remove_layer(o),"object"==typeof a&&method.map.remove_layer(a),"object"==typeof v&&e.removeControl(v),h=[],y=[],b="",v="",_=!0)}},get_data:{find_route_type:function(e,a){jQuery(".ui-autocomplete").hide(),-1!=jQuery.inArray(e.toLowerCase(),d)?(method.map.clear_all(),jQuery("#menu_wrapper").removeClass("menuWrapperActive"),b=e,_=!0,method.update_anchor_tag(b),method.get_data.get_rail_line(),method.get_data.get_rail_data()):-1!=jQuery.inArray(e.toLowerCase(),u)||-1!=jQuery.inArray(e.toLowerCase(),c)?(method.map.clear_all(),jQuery("#menu_wrapper").removeClass("menuWrapperActive"),b=e,_=!0,method.update_anchor_tag(b),method.get_data.get_bus_line(-1!=jQuery.inArray(e.toLowerCase(),u)?"bus":"trolley"),method.get_data.get_bus_data(-1!=jQuery.inArray(e.toLowerCase(),u)?"bus":"trolley")):(_=!1,a?(alert("Sorry, that route doesn't exist"),b=null,method.update_anchor_tag(b)):(jQuery(".preloaderWrapper").hide(),jQuery(".searchWrapper").show(),method.update_anchor_tag(null)))},get_bus_data:function(e){jQuery(".preloaderWrapper").show(),jQuery(".searchWrapper").hide(),jQuery("#menu_wrapper").removeClass("menuWrapperActive");var a=(new Date).getTime();jQuery.ajax({url:"http://www3.septa.org/hackathon/TransitView/?route="+b+"&ts="+a+"&callback=?",dataType:"json",success:function(a){method.map.add_points(a,e),method.timer.start(),n=setTimeout(function(){method.map.remove_layer(t),method.map.remove_layer(r),null!=b&&method.get_data.get_bus_data(e)},6e4)},error:function(){alert("Sorry, something went wrong"),jQuery(".preloaderWrapper").hide(),jQuery(".searchWrapper").show()}})},get_bus_line:function(e){jQuery.ajax({url:"routes/routes_"+b+".kml",dataType:"text",success:function(a){method.map.add_bus_lines(toGeoJSON.kml(jQuery.parseXML(a)),e)},error:function(){alert("Sorry, something went wrong")}})},get_bus_stops:function(){jQuery(".preloaderWrapper").show(),jQuery.ajax({url:"http://www3.septa.org/hackathon/Stops/?req1="+b+"&callback=?",dataType:"json",success:function(e){jQuery(".preloaderWrapper").hide(),h=e,method.map.add_all_stops()},error:function(){alert("Sorry, something went wrong")}})},get_rail_data:function(){jQuery(".preloaderWrapper").show(),jQuery(".searchWrapper").hide(),jQuery("#menu_wrapper").removeClass("menuWrapperActive");var e=(new Date).getTime();jQuery.ajax({url:"http://www3.septa.org/hackathon/TrainView/?dm="+b+"&ts="+e+"&callback=?",dataType:"json",success:function(e){var a={};a.train=e,method.map.add_points(a,"train"),method.timer.start(),n=setTimeout(function(){method.map.remove_layer(t),null!=b&&method.get_data.get_rail_data()},6e4)},error:function(){alert("Sorry, something went wrong"),jQuery(".preloaderWrapper").hide(),jQuery(".searchWrapper").show()}})},get_rail_line:function(){jQuery.ajax({url:"routes/regional_rail.kml",dataType:"text",success:function(e){method.map.add_train_lines(toGeoJSON.kml(jQuery.parseXML(e)))},error:function(){alert("Sorry, something went wrong")}})},find_stations:function(e,a){jQuery(".preloaderWrapper").show(),jQuery(".searchWrapper").hide(),jQuery("#menu_wrapper").removeClass("menuWrapperActive"),method.map.clear_all(),method.update_anchor_tag(null);(new Date).getTime();jQuery.ajax({url:"http://www3.septa.org/hackathon/locations/get_locations.php?lon="+a+"&lat="+e+"&callback=?&radius=3",dataType:"jsonp",success:function(e){method.map.add_found_stops(e)},error:function(){alert("Sorry, something went wrong")}})},arrival_times:function(e,a){jQuery(".arrivalTableWrapper").show(),jQuery(".arrivalTable").empty(),jQuery.ajax({url:"http://www3.septa.org/hackathon/NextToArrive/?req1="+method.parse_data.capitalize_first_letter(e)+"&req2="+method.parse_data.capitalize_first_letter(a)+"&req3=5&callback=?",dataType:"json",success:function(e){if(jQuery(".spinnerWrapper").slideUp(150),jQuery(".arrivalTable").slideDown(150),0==e.length)jQuery(".arrivalTable").html('<tr style="position: relative; text-align: center;"><td style="font-weight: 700; color: #d9534f">No Results Found</td></tr>');else{jQuery(".arrivalTable").html("<tr><th>Line</th><th>Departure</th><th>Arrival</th><th>Late</th></tr>");for(var a in e)jQuery(".arrivalTable").append("<tr><td>"+e[a].orig_line+"</td><td>"+e[a].orig_departure_time+"</td><td>"+e[a].orig_arrival_time+'</td><td><span class="badge badge-'+("on time"==e[a].orig_delay.toLowerCase()?"success":"danger")+'">'+("on time"==e[a].orig_delay.toLowerCase()?"0 min":e[a].orig_delay)+"</span></td></tr>")}},error:function(){jQuery(".spinnerWrapper").slideUp(150),jQuery(".arrivalTable").slideDown(150),jQuery(".arrivalTable").html("No Results Found")}})}},parse_data:{calc_time:function(e){var a=Math.floor(e/60);return 0==a?"Less than 1 min ago":a+" min "+Math.round(Math.floor(100*(e/60%1)*60)/100).toString()+" sec ago"},capitalize_first_letter:function(e){return e.toLowerCase().replace(/\b\w/g,function(e){return e.toUpperCase()})}},geocode:{google:function(e){if(jQuery(".preloaderWrapper").show(),jQuery(".searchWrapper").hide(),jQuery("#menu_wrapper").removeClass("menuWrapperActive"),!m){var a=document.createElement("script");a.type="text/javascript",a.src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=gmap_draw",window.gmap_draw=function(){geocoder=new google.maps.Geocoder,geocoder.geocode({address:e+"Philadelphia, Pa"},function(e,a){a==google.maps.GeocoderStatus.OK?method.get_data.find_stations(e[0].geometry.location.A,e[0].geometry.location.F):alert("Geocode was not successful for the following reason: "+a)}),m=!0},jQuery("head").append(a)}}},timer:{start:function(){jQuery("#timer").data("pietimer")?(jQuery("#timer").pietimer("reset"),jQuery("#timer").pietimer("start")):jQuery("#timer").pietimer({timerSeconds:60,fill:!1,showPercentage:!1,callback:function(){jQuery("#timer").pietimer("reset"),jQuery("#timer").pietimer("start")}})}}},method}();!function(e){e.fn.pietimer=function(t){return a[t]?a[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.pietimer"):a.init.apply(this,arguments)};var a={init:function(a){var t={timer:null,timerSeconds:10,callback:function(){},timerCurrent:0,showPercentage:!1,fill:!1,color:"#337ab7"};return t=e.extend(t,a),this.each(function(){var a=e(this),r=a.data("pietimer");r||(a.addClass("pietimer"),a.css({fontSize:a.width()}),a.data("pietimer",t),t.showPercentage&&a.find(".percent").show(),t.fill&&a.addClass("fill"),a.pietimer("start"))})},stopWatch:function(){var a=e(this).data("pietimer");if(a){var t=(a.timerFinish-(new Date).getTime())/1e3;if(0>=t)clearInterval(a.timer),e(this).pietimer("drawTimer",100),a.callback();else{var r=100-t/a.timerSeconds*100;e(this).pietimer("drawTimer",r)}}},drawTimer:function(a){$this=e(this);var t=$this.data("pietimer");if(t){$this.html('<div class="percent"></div><div class="slice'+(a>50?' gt50"':'"')+'><div class="pie"></div>'+(a>50?'<div class="pie fill"></div>':"")+"</div>");var r=3.6*a;$this.find(".slice .pie").css({"-moz-transform":"rotate("+r+"deg)","-webkit-transform":"rotate("+r+"deg)","-o-transform":"rotate("+r+"deg)",transform:"rotate("+r+"deg)"}),$this.find(".percent").html(Math.round(a)+"%"),t.showPercentage&&$this.find(".percent").show(),$this.find(".slice .pie").css($this.hasClass("fill")?{backgroundColor:t.color}:{borderColor:t.color})}},start:function(){var a=e(this).data("pietimer");a&&(a.timerFinish=(new Date).getTime()+1e3*a.timerSeconds,e(this).pietimer("drawTimer",0),a.timer=setInterval("$this.pietimer('stopWatch')",50))},reset:function(){var a=e(this).data("pietimer");a&&(clearInterval(a.timer),e(this).pietimer("drawTimer",0))}}}(jQuery);