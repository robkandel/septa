var toGeoJSON=function(){"use strict";function e(e,t){return e.getElementsByTagName(t)}function t(e,t){return e.getAttribute(t)}function r(t,r){var n=e(t,r);return n.length?n[0]:null}function n(e){return e.normalize&&e.normalize(),e}function i(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function o(e){return e&&n(e),e&&e.firstChild&&e.firstChild.nodeValue||""}function l(e){return i(e.replace(f,"").split(","))}function a(e){for(var t=e.replace(c,"").split(p),r=[],n=0;n<t.length;n++)r.push(l(t[n]));return r}function s(){return{type:"FeatureCollection",features:[]}}var u,f=/\s*/g,c=/^\s*|\s*$/g,p=/\s+/;"undefined"!=typeof XMLSerializer?u=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(u=new(require("xmldom").XMLSerializer));var g={kml:function(n,u){function f(e){var t,r;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),(6===e.length||3===e.length)&&(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t=e.substr(2)),[t,isNaN(r)?void 0:r]}function c(e){return i(e.split(" "))}function p(t){for(var r=e(t,"coord","gx"),n=[],i=0;i<r.length;i++)n.push(c(o(r[i])));return n}function g(t){var n,i,s,u,f,c=[];if(r(t,"multiGeometry"))return g(r(t,"MultiGeometry"));if(r(t,"multigeometry"))return g(r(t,"multigeometry"));if(r(t,"MultiTrack"))return g(r(t,"MultiTrack"));if(r(t,"multitrack"))return g(r(t,"multitrack"));for(s=0;s<m.length;s++)if(i=e(t,m[s]))for(u=0;u<i.length;u++)if(n=i[u],"point"==m[s].toLowerCase())c.push({type:"Point",coordinates:l(o(r(n,"coordinates")))});else if("linestring"==m[s].toLowerCase())c.push({type:"LineString",coordinates:a(o(r(n,"coordinates")))});else if("polygon"==m[s].toLowerCase()){var h=e(n,"LinearRing"),y=[];for(f=0;f<h.length;f++)y.push(a(o(r(h[f],"coordinates"))));c.push({type:"Polygon",coordinates:y})}else"track"==m[s].toLowerCase()&&c.push({type:"LineString",coordinates:p(n)});return c}function h(t,n){var i,l=g(t),a={},s=o(r(t,"name")),u=o(r(t,"styleUrl")),c=(o(r(t,"StyleMap")),o(r(t,"description"))),p=r(t,"TimeSpan"),h=r(t,"ExtendedData"),y=r(t,"LineStyle"),m=r(t,"PolyStyle"),v=r(t,"IconStyle");if(n&&!l.length)return[];if(s&&(a.name=s),n||(a.id=$(t).attr("id")),u&&d[u]&&(a.styleUrl=u,a.styles=d[u],u+"-hover"in d&&(a.map=!0,a.style_hover=d[u+"-hover"],a.styleUrl_hover=u+"-hover")),c&&(a.description=c),p){var b=o(r(p,"begin")),k=o(r(p,"end"));a.timespan={begin:b,end:k}}if(m){var S=f(o(r(m,"color"))),L=S[0],N=S[1],w=o(r(m,"fill")),C=o(r(m,"outline"));L&&(a.fill=L),isNaN(N)||(a["fill-opacity"]=N),w&&(a["fill-opacity"]="1"===w?1:0),C&&(a["stroke-opacity"]="1"===C?1:0)}if(y){var M=f(o(r(y,"color"))),j=M[0],x=M[1],z=parseFloat(o(r(y,"width")));j&&(a.stroke=j),isNaN(x)||(a["stroke-opacity"]=x),isNaN(z)||(a["stroke-width"]=z)}if(v){var F=o(r(v,"href"));F&&(a.icon=F)}if(h){var G=e(h,"Data"),Q=e(h,"SimpleData");for(i=0;i<G.length;i++)a[G[i].getAttribute("name")]=o(r(G[i],"value"));for(i=0;i<Q.length;i++)a[Q[i].getAttribute("name")]=o(Q[i]);if(n&&0==G.length&&0==Q.length)for(var T=0;T<jQuery(h).children().length;T++)a[jQuery(h).children()[T].nodeName]=jQuery(jQuery(h).children()[T]).text()}return n?[{type:"Feature",geometry:1===l.length?l[0]:{type:"GeometryCollection",geometries:l},properties:a}]:a}u=u||{};for(var y=s(),d={},m=["polygon","linestring","point","track"],v=e(n,"placemark"),b=e(n,"style"),k=e(n,"stylemap"),S=0;S<b.length;S++)d["#"+t(b[S],"id")]=h(b[S],!1);for(var L=0;L<k.length;L++)d["#"+t(k[L],"id")]=h(k[L],!1);for(var N=0;N<v.length;N++)y.features=y.features.concat(h(v[N],!0));return y}};return g}();